# ğŸ“… Booking API - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª

## ğŸ“‹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

- [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#-Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
- [Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©](#-Ù†Ù‚Ø§Ø·-Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)
- [Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…](#-Ø£Ù…Ø«Ù„Ø©-Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)

---

## ğŸŒŸ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙŠÙˆÙØ± Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ **Snapshot-based Architecture** Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆÙ†Ø¸Ø§Ù… **TTL** Ù„Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©.

**Base URL**: `/api/v1/bookings`

---

## ğŸ“ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©

### 1. Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯

```http
POST /api/v1/bookings
```

**Request Body**:

```json
{
  "guestId": "a7b8f226-48ee-4df9-b2f2-8ca9637e02c8",
  "itemType": "TRAVEL_PACK",
  "itemId": "673abc456789012345678901",
  "startDate": "2025-11-10T00:00:00.000Z",
  "endDate": "2025-11-15T00:00:00.000Z",
  "numberOfPersons": 2
}
```

**Response** (201):

```json
{
  "success": true,
  "data": {
    "bookingNumber": "BKG-20251102-0001",
    "guestId": "673abc123...",
    "itemType": "TRAVEL_PACK",
    "snapshot": {
      "itemId": "673abc456...",
      "title": "Ala-Archa National Park Tour",
      "price": 150,
      "description": "...",
      "imageUrl": "..."
    },
    "startDate": "2025-11-10T00:00:00.000Z",
    "endDate": "2025-11-15T00:00:00.000Z",
    "numberOfPersons": 2,
    "totalPrice": 300,
    "status": "pending",
    "paymentStatus": "unpaid"
  }
}
```

---

### 2. Ø¬Ù„Ø¨ Ø­Ø¬Ø² Ø¨Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²

```http
GET /api/v1/bookings/:bookingNumber
```

**Ù…Ø«Ø§Ù„**: `GET /api/v1/bookings/BKG-20251102-0001`

---

### 3. Ø­Ø¬ÙˆØ²Ø§Øª Ø¶ÙŠÙ Ù…Ø¹ÙŠÙ†

```http
GET /api/v1/bookings/guest/:guestId
```

**ÙŠØ¯Ø¹Ù…**: UUID session Ø£Ùˆ MongoDB ObjectId

---

### 4. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹

```http
POST /api/v1/bookings/:bookingNumber/payment
```

**Request Body**:

```json
{
  "paymentMethod": "CREDIT_CARD",
  "transactionId": "TXN-987654321"
}
```

**Response** (200):

```json
{
  "success": true,
  "data": {
    "bookingNumber": "BKG-20251102-0001",
    "status": "confirmed",
    "paymentStatus": "paid",
    "paidAt": "2025-11-02T10:40:00.000Z"
  }
}
```

---

### 5. Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø²

```http
POST /api/v1/bookings/:bookingNumber/cancel
```

**Request Body**:

```json
{
  "reason": "Change of plans"
}
```

---

### 6. Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª

```http
GET /api/v1/bookings?page=1&limit=10&status=confirmed
```

**Query Parameters**:

- `page`: Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© (default: 1)
- `limit`: Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (default: 10)
- `status`: pending | confirmed | cancelled | expired
- `paymentStatus`: unpaid | paid | refunded

---

### 7. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²

```http
GET /api/v1/bookings/:bookingNumber/details
```

---

### 8. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª

```http
GET /api/v1/bookings/statistics
```

**Response** (200):

```json
{
  "success": true,
  "data": {
    "totalBookings": 156,
    "pendingBookings": 23,
    "confirmedBookings": 120,
    "cancelledBookings": 10,
    "expiredBookings": 3,
    "totalRevenue": 45000,
    "averageBookingValue": 288
  }
}
```

---

### 9. Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©

```http
DELETE /api/v1/bookings/cleanup
```

---

## ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø² (Booking Number)

### Ø§Ù„ØªÙ†Ø³ÙŠÙ‚

```
BKG-YYYYMMDD-####

Ù…Ø«Ø§Ù„: BKG-20251102-0001
```

### Ø§Ù„ØªÙˆÙ„ÙŠØ¯

- **BKG**: Ø¨Ø§Ø¯Ø¦Ø© Ø«Ø§Ø¨ØªØ©
- **YYYYMMDD**: ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
- **####**: Ø¹Ø¯Ø§Ø¯ ÙŠÙˆÙ…ÙŠ (ÙŠØ¨Ø¯Ø£ Ù…Ù† 0001)

---

## ğŸ“¸ Snapshot System

### Ù„Ù…Ø§Ø°Ø§ SnapshotØŸ

âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±  
âœ… Ø­ÙØ¸ ØªØ§Ø±ÙŠØ®ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª  
âœ… Ù‚Ø§Ø¨Ù„ÙŠØ© Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚

### Ù…Ø­ØªÙˆÙ‰ Snapshot

```json
{
  "itemId": "...",
  "title": "...",
  "description": "...",
  "price": 150,
  "imageUrl": "...",
  "category": "...",
  "duration": "5 days"
}
```

---

## â° TTL (Time To Live)

Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª **ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©** ØªÙØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ **24 Ø³Ø§Ø¹Ø©**.

```javascript
// TTL Index
BookingSchema.index(
  { createdAt: 1 },
  {
    expireAfterSeconds: 86400,
    partialFilterExpression: { paymentStatus: 'unpaid' },
  }
);
```

---

## ğŸ’¡ Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ø±Ø­Ù„Ø© Ø­Ø¬Ø² ÙƒØ§Ù…Ù„Ø©

```javascript
// 1. Create Guest
const guest = await createGuest({
  email: 'tourist@example.com',
  name: 'Ahmed Khan',
});

// 2. Browse Travel Packs
const packs = await getTravelPacks({ language: 'en' });

// 3. Create Booking
const booking = await createBooking({
  guestId: guest.sessionId,
  itemType: 'TRAVEL_PACK',
  itemId: packs[0]._id,
  startDate: '2025-11-10T00:00:00.000Z',
  endDate: '2025-11-15T00:00:00.000Z',
  numberOfPersons: 2,
});

// 4. Process Payment
await processPayment(booking.bookingNumber, {
  paymentMethod: 'CREDIT_CARD',
  transactionId: 'TXN-123',
});
```

---

_ğŸ“˜ Auto-generated by Copilot Documentation Architect â€” ExploreKG Server Project_

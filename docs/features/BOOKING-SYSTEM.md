# ğŸ“… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª - Booking System

## ğŸ“‹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

- [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#-Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
- [Snapshot Architecture](#-snapshot-architecture)
- [Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²](#-Ø±Ù‚Ù…-Ø§Ù„Ø­Ø¬Ø²)
- [TTL Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª](#-ttl-Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª)
- [Payment Flow](#-payment-flow)

---

## ğŸŒŸ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø­Ø¬ÙˆØ²Ø§Øª Ø´Ø§Ù…Ù„ Ù…Ø¹ **Snapshot-based Architecture** Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.

---

## ğŸ“¸ Snapshot Architecture

### Ù…Ø§ Ù‡Ùˆ SnapshotØŸ

Ù†Ø³Ø®Ø© **Ø«Ø§Ø¨ØªØ© ÙˆØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ±** Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¬ÙˆØ² ÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø².

### Ù„Ù…Ø§Ø°Ø§ØŸ

âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±  
âœ… Ø­ÙØ¸ ØªØ§Ø±ÙŠØ®ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª  
âœ… Audit Trail ÙƒØ§Ù…Ù„

### Ù…Ø­ØªÙˆÙ‰ Snapshot

```json
{
  "itemId": "673abc...",
  "title": "Ala-Archa Park Tour",
  "description": "...",
  "price": 150,
  "imageUrl": "...",
  "category": "nature",
  "duration": "5 days"
}
```

---

## ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²

### Ø§Ù„ØªÙ†Ø³ÙŠÙ‚

```
BKG-YYYYMMDD-####
```

### Ù…Ø«Ø§Ù„

```
BKG-20251102-0001
BKG-20251102-0002
BKG-20251103-0001  â† Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯
```

### Ø§Ù„ØªÙˆÙ„ÙŠØ¯ (Atomic)

```typescript
BookingCounter.findOneAndUpdate(
  { date: '20251102' },
  { $inc: { count: 1 } },
  { upsert: true, new: true }
);
```

---

## â° TTL Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª

### Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©

Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª **ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©** ØªÙØ­Ø°Ù Ø¨Ø¹Ø¯ **24 Ø³Ø§Ø¹Ø©**.

### Implementation

```javascript
BookingSchema.index(
  { createdAt: 1 },
  {
    expireAfterSeconds: 86400,
    partialFilterExpression: {
      paymentStatus: 'unpaid',
    },
  }
);
```

---

## ğŸ’³ Payment Flow

```
1. Create Booking (status: pending, payment: unpaid)
2. Process Payment â†’ status: confirmed, payment: paid
3. Safe from TTL deletion
```

---

## ğŸ“Š Statistics

```
Total Endpoints: 9
Booking Number Format: BKG-YYYYMMDD-####
Snapshot Protection: âœ…
TTL Cleanup: 24 hours
Supported Types: TravelPack, Activity, Car
```

---

_ğŸ“˜ Auto-generated by Copilot Documentation Architect â€” ExploreKG Server Project_

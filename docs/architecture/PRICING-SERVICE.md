# Pricing Service - Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…ÙˆØ­Ø¯Ø©

**Ø§Ù„ØªØ§Ø±ÙŠØ®**: 2025-01-27  
**Ø§Ù„Ù…Ø±Ø­Ù„Ø©**: Phase 7.2 - Pricing Unification  
**Ø§Ù„Ø­Ø§Ù„Ø©**: âœ… Ù…ÙˆØ«Ù‚

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ù‡ÙŠÙƒÙ„](#Ø§Ù„Ù‡ÙŠÙƒÙ„)
3. [Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©](#Ø§Ù„ÙˆØ¸Ø§Ø¦Ù-Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
4. [Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…](#Ø£Ù…Ø«Ù„Ø©-Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)
5. [Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰](#Ø§Ù„ØªÙƒØ§Ù…Ù„-Ù…Ø¹-Ø§Ù„Ø®Ø¯Ù…Ø§Øª-Ø§Ù„Ø£Ø®Ø±Ù‰)
6. [Ø§Ù„ØªÙƒÙˆÙŠÙ†](#Ø§Ù„ØªÙƒÙˆÙŠÙ†)

---

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

**PricingService** Ù‡Ùˆ Ø®Ø¯Ù…Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…. ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ Phase 7.2 Ù„Ø¶Ù…Ø§Ù† Ø§ØªØ³Ø§Ù‚ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª.

### Ø§Ù„Ø£Ù‡Ø¯Ø§Ù

1. **Ø§Ù„Ø§ØªØ³Ø§Ù‚**: Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ³Ø¹ÙŠØ± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
2. **Ø§Ù„Ù…Ø±ÙˆÙ†Ø©**: Ø¯Ø¹Ù… Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© (Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø®ØµÙ…ØŒ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©)
3. **Ø§Ù„Ù‚Ø§Ø¨Ù„ÙŠØ© Ù„Ù„ØµÙŠØ§Ù†Ø©**: Ù…Ù†Ø·Ù‚ Ù…ÙˆØ­Ø¯ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯
4. **Ø§Ù„Ù‚Ø§Ø¨Ù„ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±**: Ø³Ù‡ÙˆÙ„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ³Ø¹ÙŠØ±

### Ø§Ù„Ù…ÙˆÙ‚Ø¹

```
src/services/pricing.service.ts
```

---

## Ø§Ù„Ù‡ÙŠÙƒÙ„

### Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

```typescript
// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
calculateSubtotal(snapshot, data): number

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
applyTax(subtotal, taxRate?): number

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
applyDiscount(price, discountPercentage): { discountedPrice, discountAmount }

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
calculateTotal(subtotal, options?): number

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
calculateDeposit(total, depositRate?): number

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ù…Ù„
calculatePrice(snapshot, data, options?): PricingBreakdown

// Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Pack Relations
calculatePackRelationPrice(activitiesTotal, carsTotal, optionalActivitiesTotal, globalDiscount?, options?): PricingBreakdown
```

### Interfaces

```typescript
interface PricingOptions {
  taxRate?: number;
  discountPercentage?: number;
  depositRate?: number;
  includeTax?: boolean;
  includeDeposit?: boolean;
}

interface PricingBreakdown {
  subtotal: number;
  tax: number;
  discount: number;
  discountAmount: number;
  total: number;
  deposit?: number;
}
```

---

## Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. calculateSubtotal

Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ± ÙˆØ§Ù„ÙƒÙ…ÙŠØ©.

```typescript
const subtotal = calculateSubtotal(snapshot, data);
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `snapshot`: BookingSnapshot - Ù„Ù‚Ø·Ø© Ø§Ù„Ø¹Ù†ØµØ±
- `data`: CreateBookingData - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `number`: Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- Ù„Ù„Ø£Ù†Ø´Ø·Ø©/Ø§Ù„Ø­Ø²Ù…: `pricePerPerson Ã— numberOfPersons`
- Ù„Ù„Ø³ÙŠØ§Ø±Ø§Øª: `pricePerDay Ã— numberOfDays`
- Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†

---

### 2. applyTax

ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ.

```typescript
const tax = applyTax(subtotal, taxRate?);
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `subtotal`: number - Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
- `taxRate?`: number - Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ 10%)

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `number`: Ù…Ø¨Ù„Øº Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- ÙŠØ³ØªØ®Ø¯Ù… `TaxPolicy.calculateTax()`
- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: 10%
- ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©

---

### 3. applyDiscount

ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø±.

```typescript
const result = applyDiscount(price, discountPercentage);
// result = { discountedPrice: 90, discountAmount: 10 }
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `price`: number - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
- `discountPercentage`: number - Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (0-100%)

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `{ discountedPrice: number, discountAmount: number }`

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- ÙŠØ³ØªØ®Ø¯Ù… `DiscountPolicy.applyDiscount()`
- Ø§Ù„Ø®ØµÙ… ÙƒÙ†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (0-100%)
- Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†

---

### 4. calculateTotal

Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø®ØµÙ….

```typescript
const total = calculateTotal(subtotal, {
  discountPercentage: 10,
  includeTax: true,
  taxRate: 0.1
});
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `subtotal`: number - Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
- `options?`: PricingOptions - Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `number`: Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø£ÙˆÙ„Ø§Ù‹ (Ø¥Ù† ÙˆÙØ¬Ø¯)
- Ø«Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
- Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†

---

### 5. calculateDeposit

Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©.

```typescript
const deposit = calculateDeposit(total, depositRate?);
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `total`: number - Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
- `depositRate?`: number - Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙØ¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ 20%)

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `number`: Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- ÙŠØ³ØªØ®Ø¯Ù… `DepositPolicy.calculateDeposit()`
- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: 20%
- Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†

---

### 6. calculatePrice

Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©).

```typescript
const pricing = calculatePrice(snapshot, data, {
  discountPercentage: 10,
  includeTax: true,
  includeDeposit: true
});
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `snapshot`: BookingSnapshot - Ù„Ù‚Ø·Ø© Ø§Ù„Ø¹Ù†ØµØ±
- `data`: CreateBookingData - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²
- `options?`: PricingOptions - Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `PricingBreakdown`: ØªÙØµÙŠÙ„ ÙƒØ§Ù…Ù„ Ù„Ù„Ø³Ø¹Ø±

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… (Ø¥Ù† ÙˆÙØ¬Ø¯)
3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
5. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (Ø¥Ù† Ø·ÙÙ„Ø¨)

---

### 7. calculatePackRelationPrice

Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Pack Relations (Ù„Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©).

```typescript
const pricing = calculatePackRelationPrice(
  activitiesTotal,
  carsTotal,
  optionalActivitiesTotal,
  globalDiscount,
  { includeTax: false, includeDeposit: true }
);
```

**Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**:
- `activitiesTotal`: number - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
- `carsTotal`: number - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
- `optionalActivitiesTotal`: number - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)
- `globalDiscount?`: number - Ø®ØµÙ… Ø¹Ø§Ù… (Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©)
- `options?`: PricingOptions - Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**:
- `PricingBreakdown`: ØªÙØµÙŠÙ„ ÙƒØ§Ù…Ù„ Ù„Ù„Ø³Ø¹Ø±

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯**:
- Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ = Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© + Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
- Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ù„Ø§ ØªÙØ­Ø³Ø¨ ÙÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ
- Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ø§ÙØªØ±Ø§Ø¶ÙŠ: ØºÙŠØ± Ù…Ø¶Ù…Ù†Ø©)
- Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©

---

## Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ù…Ø«Ø§Ù„ 1: Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ù†Ø´Ø§Ø· Ø¨Ø³ÙŠØ·

```typescript
import { calculatePrice } from '../services/pricing.service';

const snapshot: BookingSnapshot = {
  itemType: BookingItemType.ACTIVITY,
  itemId: 'activity-123',
  title: 'Hiking Tour',
  pricePerPerson: 50,
  currency: 'USD',
  locale: 'en',
  snapshotAt: new Date(),
};

const data: CreateBookingData = {
  guestId: 'guest-123',
  itemType: BookingItemType.ACTIVITY,
  itemId: 'activity-123',
  numberOfPersons: 2,
};

const pricing = calculatePrice(snapshot, data);
// Result:
// {
//   subtotal: 100,
//   tax: 10,
//   discount: 0,
//   discountAmount: 0,
//   total: 110
// }
```

### Ù…Ø«Ø§Ù„ 2: Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ù…Ø¹ Ø®ØµÙ…

```typescript
const pricing = calculatePrice(snapshot, data, {
  discountPercentage: 10,
});
// Result:
// {
//   subtotal: 100,
//   tax: 9,        // 10% of 90
//   discount: 10,
//   discountAmount: 10,
//   total: 99      // 90 + 9
// }
```

### Ù…Ø«Ø§Ù„ 3: Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ù…Ø¹ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©

```typescript
const pricing = calculatePrice(snapshot, data, {
  includeDeposit: true,
});
// Result:
// {
//   subtotal: 100,
//   tax: 10,
//   discount: 0,
//   discountAmount: 0,
//   total: 110,
//   deposit: 22    // 20% of 110
// }
```

### Ù…Ø«Ø§Ù„ 4: Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Pack Relation

```typescript
import { calculatePackRelationPrice } from '../services/pricing.service';

const pricing = calculatePackRelationPrice(
  200,  // activitiesTotal
  300,  // carsTotal
  100,  // optionalActivitiesTotal
  10,   // globalDiscount (10%)
  { includeDeposit: true }
);
// Result:
// {
//   subtotal: 500,      // 200 + 300
//   tax: 0,             // Tax not included
//   discount: 10,
//   discountAmount: 50,  // 10% of 500
//   total: 450,         // 500 - 50
//   deposit: 90         // 20% of 450
// }
```

---

## Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰

### Booking Service

```typescript
// src/services/booking.service.ts
import { calculatePrice } from './pricing.service';

const calculateBookingPrice = (snapshot, data) => {
  const pricing = calculatePrice(snapshot, data, {
    includeTax: true,
    includeDeposit: false,
  });

  return {
    subtotal: pricing.subtotal,
    tax: pricing.tax,
    discount: pricing.discount,
    totalPrice: pricing.total,
  };
};
```

### PackRelation Service

```typescript
// src/services/packRelation.service.ts
import { calculatePackRelationPrice, DepositPolicy } from './pricing.service';

const calculateTotalPrice = (activities, cars, pricingConfig) => {
  // ... calculate totals ...
  
  const pricing = calculatePackRelationPrice(
    activitiesTotal,
    carsTotal,
    optionalActivitiesTotal,
    pricingConfig.globalDiscount,
    {
      includeTax: false,
      includeDeposit: true,
    }
  );

  return {
    subtotal: pricing.subtotal,
    globalDiscount: pricing.discount,
    discountAmount: pricing.discountAmount,
    finalTotal: pricing.total,
    deposit: pricing.deposit,
  };
};
```

---

## Ø§Ù„ØªÙƒÙˆÙŠÙ†

### Pricing Configuration

```typescript
// src/config/pricing.config.ts
export const DEFAULT_TAX_RATE = 0.1;        // 10%
export const DEFAULT_DEPOSIT_RATE = 0.2;    // 20%

export const getTaxRate = (): number => {
  const envTaxRate = process.env.TAX_RATE;
  if (envTaxRate) {
    const rate = parseFloat(envTaxRate);
    if (!isNaN(rate) && rate >= 0 && rate <= 1) {
      return rate;
    }
  }
  return DEFAULT_TAX_RATE;
};

export const getDepositRate = (): number => {
  const envDepositRate = process.env.DEPOSIT_RATE;
  if (envDepositRate) {
    const rate = parseFloat(envDepositRate);
    if (!isNaN(rate) && rate >= 0 && rate <= 1) {
      return rate;
    }
  }
  return DEFAULT_DEPOSIT_RATE;
};
```

### Environment Variables

```bash
# .env
TAX_RATE=0.1          # 10% (default)
DEPOSIT_RATE=0.2      # 20% (default)
```

---

## Ù…Ù„Ø®Øµ

| Ø§Ù„ÙˆØ¸ÙŠÙØ© | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|-------|-----------|
| `calculateSubtotal` | Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ | BookingService |
| `applyTax` | ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© | Ø¯Ø§Ø®Ù„ÙŠ |
| `applyDiscount` | ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… | Ø¯Ø§Ø®Ù„ÙŠ |
| `calculateTotal` | Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ | Ø¯Ø§Ø®Ù„ÙŠ |
| `calculateDeposit` | Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙØ¹Ø© | PackRelationService |
| `calculatePrice` | Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ù…Ù„ | BookingService |
| `calculatePackRelationPrice` | Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Pack | PackRelationService |

---

**ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨ÙˆØ§Ø³Ø·Ø©**: AI Assistant  
**Ø§Ù„ØªØ§Ø±ÙŠØ®**: 2025-01-27  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±**: 1.0

